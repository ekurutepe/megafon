(function($){$.fn.rfg=function(userOptions){rfg.options=$.extend(true,{},rfg.defaults,userOptions);rfg.el=$(this);rfg.el.prepend('<div class="rfg-images"></div>');rfg.el.find('.rfg-images').css({'height':rfg.options.initialHeight});rfg.loading.start();$(window).load(function(){rfg.ajax.buildFlickrCalls();});};var rfg={};rfg.defaults={categories:true,flickrSets:[],flickrOptions:{useTitle:false,imageSize:'m'},categoryOptions:{includeAll:true,defaultCategory:false},lightbox:true,imageWidth:300,spacing:10,center:true,initialHeight:0};rfg.init=function(){if(rfg.options.lightbox){rfg.lightbox.addOverlay();sgInitalizeLightbox();}
if(rfg.options.categories){rfg.categories.init();}
rfg.images.resize();rfg.images.show();rfg.utils.addTransition(rfg.el.find('.rfg-images > div'));rfg.categories.filterBy(rfg.options.categoryOptions.defaultCategory);var resize=function(){if((size.width===$(window).width())){return;}
size.width=$(window).width();size.height=$(window).height();rfg.images.sort();rfg.images.center();};var size={width:$(window).width(),height:$(window).height()};var resizeTimer;$(window).resize(function(){clearTimeout(resizeTimer);resizeTimer=setTimeout(resize,200);});if(navigator.appVersion.indexOf("MSIE 7.")!=-1){rfg.el.find('.rfg-categories > li').css('display','inline').find('a').css({'display':'block','padding':'3px 7px'});}};rfg.ajax={};rfg.ajax.checkInValue=0;rfg.ajax.buildFlickrCalls=function(){var i=0,setCoutner=rfg.options.flickrSets.length;for(i=0;i<rfg.options.flickrSets.length;i++){var singleSet=rfg.options.flickrSets[i];var infoApiCall="http://api.flickr.com/services/rest/?format=json&method=flickr.photosets.getInfo&photoset_id="+
singleSet.setId+"&per_page=18&page=1&api_key="+singleSet.apiKey+"&jsoncallback=?";rfg.ajax.makeFlickrCalls(infoApiCall,singleSet);}};rfg.ajax.makeFlickrCalls=function(infoApiCall,singleSet){$.getJSON(infoApiCall,function(data){var category=data.photoset.title._content;var apiCall="http://api.flickr.com/services/rest/?format=json&method=flickr.photosets.getPhotos&photoset_id="+
singleSet.setId+"&per_page=18&page=1&api_key="+singleSet.apiKey+"&jsoncallback=?&extras=description, license, date_upload, date_taken, owner_name, icon_server, original_format, last_update, geo, tags, machine_tags, o_dims, views, media, path_alias, url_sq, url_t, url_s, url_q, url_m, url_n, url_z, url_c, url_l, url_o";$.getJSON(apiCall,function(data){var imageCount=0;$.each(data.photoset.photo,function(i,photo){var type='url_'+rfg.options.flickrOptions.imageSize;var img_src=photo[type];var image=$('<img/>').attr('src',img_src).load(function(){var link=$('<a></a>').attr('href',img_src).attr('rel','lightbox[on]').append(image);if(rfg.options.flickrOptions.useTitle===true){link.attr('title',photo.title);}
var unit=$('<div></div>').attr('data-category',category).append(link);rfg.images.imageArray.push(unit);imageCount++;if(imageCount===data.photoset.photo.length){rfg.ajax.checkInValue++;if(rfg.ajax.checkInValue===rfg.options.flickrSets.length){rfg.images.appendImageArray();rfg.init();}}});});});});};rfg.loading={image:$("<img src='images/loading.gif'/>"),start:function(){this.image.css({'position':'absolute','top':(rfg.el.position().top)+150,'left':(rfg.el.width()-this.image.width())/2});rfg.el.prepend(this.image);},stop:function(){this.image.remove();}};rfg.lightbox={};rfg.lightbox.addOverlay=function(){var units=rfg.el.find('.rfg-images > div').css({'cursor':'pointer'}).append('<span></span>');if(rfg.utils.transitions){units.find('img').hover(function(){$(this).css({'opacity':'.5'});},function(){$(this).css({'opacity':'1'});});}else{units.find('img').hover(function(){$(this).clearQueue().stop().animate({'opacity':'.5'},{duration:'300'});},function(){$(this).animate({'opacity':'1'},{duration:'300'});});}};rfg.categories={};rfg.categories.init=function(){categoryList=this.generateCategoryList();var categoryMarkup=this.generateMarkup(categoryList);rfg.el.prepend(categoryMarkup);rfg.el.find('.rfg-categories a').on('click',function(e){rfg.categories.filterBy($(e.target).attr('category'));});var cc='';if((rfg.options.categoryOptions.defaultCategory)&&(categoryList.indexOf(rfg.options.categoryOptions.defaultCategory)!==-1)){cc=rfg.options.categoryOptions.defaultCategory;}else{cc=categoryList[0]}
rfg.options.categoryOptions.defaultCategory=cc;window.location.hash=cc;};rfg.categories.generateCategoryList=function(){var categories=rfg.options.categoryOptions.includeAll?["All"]:[];rfg.el.find('.rfg-images div').each(function(){var categoryArray=$(this).attr('data-category').split(',');var cursor=0;for(cursor=0;cursor<categoryArray.length;cursor++){var category=categoryArray[cursor];if($.inArray(category,categories)==-1){categories.push(category);}}});return categories;};rfg.categories.generateMarkup=function(categoryList){var items="";for(var i=0;i<categoryList.length;i++){items+="<li><a href='#"+categoryList[i]+"' category='"+categoryList[i]+"'>"+categoryList[i]+"</a></li>"}
return("<ul class='rfg-categories'>"+items+"</ul>");};rfg.categories.filterBy=function(category){if(category===rfg.categories.currentCategory){return;}
rfg.categories.setCurrentCategory(category);rfg.el.find('.rfg-images > div').each(function(){var image=$(this);var imageCategories=image.attr('data-category').split(',');var urlImage=null;if(image.find('a').attr('rel')){urlImage=image.find('a').attr('rel').indexOf('lightbox')?true:false;}else{urlImage=true;}
if((category==='All')||($.inArray(category,imageCategories)!==-1)){image.css({'display':'block'});image.find('a').attr('rel','lightbox[on]');}else{image.css({'display':'none','left':'0'});image.find('a').attr('rel','lightbox[off]');}
if(urlImage){image.find('a').attr('rel','');}});rfg.images.sort();rfg.images.center();};rfg.categories.setCurrentCategory=function(category){rfg.el.find('.rfg-categories > li > a.rfg-current-category').toggleClass('rfg-current-category');rfg.el.find('.rfg-categories > li > a').each(function(){if(category===$(this).html()){$(this).toggleClass('rfg-current-category');}});this.currentCategory=category;};rfg.images={};rfg.images.imageArray=[];rfg.images.appendImageArray=function(){rfg.images.imageArray.randomize();rfg.el.find('.rfg-images').append(rfg.images.imageArray);};rfg.images.resize=function(){var units=rfg.el.find('.rfg-images > div'),opts=rfg.options;units.each(function(){var unit=$(this);var image=$(unit.find('img')[0]);var oldWidth=image.width(),oldHeight=image.height(),ratio=opts.imageWidth/oldWidth,newWidth=opts.imageWidth,newHeight=oldHeight*ratio;$.merge(unit,unit.find('*')).css({'width':newWidth,'height':newHeight});unit.find('span').css('height',newHeight);});};rfg.images.show=function(){rfg.el.find('.rfg-images > div').css('opacity','0').css('visibility','visible').each(function(){$(this).animate({'opacity':'1'},{duration:100+Math.floor(Math.random()*900),complete:function(){rfg.loading.stop();}});});};rfg.images.sort=function(){var units=rfg.el.find('.rfg-images > div'),opts=rfg.options;var numberOfColumns=1+Math.floor((rfg.el.width()-opts.imageWidth)/(opts.imageWidth+opts.spacing));numberOfColumns=(numberOfColumns===0)?1:numberOfColumns;var columnHeights=[],i=0;for(i;i<numberOfColumns;i=i+1){columnHeights[i]=0;}
var column,tallest=0,actualColumns=0;units.each(function(){if($(this).css('display')=='none'){return;}
actualColumns++;column=columnHeights.min();if(rfg.utils.transitions){$(this).css({'top':columnHeights[column],'left':column*(opts.imageWidth+opts.spacing)});}else{$(this).animate({'top':columnHeights[column],'left':column*(opts.imageWidth+opts.spacing)},{duration:500,queue:false});}
columnHeights[column]=columnHeights[column]+$(this).height()+opts.spacing;if(columnHeights[column]>tallest){tallest=columnHeights[column];}});if(rfg.options.center){numberOfColumns=(actualColumns<numberOfColumns)?actualColumns:numberOfColumns;}
rfg.el.find('.rfg-images').css({'height':tallest,'width':(numberOfColumns*(opts.imageWidth+opts.spacing))-opts.spacing},400);};rfg.images.center=function(){if(!rfg.options.center){return;};var images=rfg.el.find('.rfg-images');var left=(rfg.el.width()-images.width())/2;left=(left<=0)?0:left;images.animate({'left':left});rfg.el.find('.rfg-categories').animate({'margin-left':left});};rfg.utils={};rfg.utils.addTransition=function(el){if(rfg.utils.transitions){el.each(function(){$(this).css({'-webkit-transition':'all 0.7s ease','-moz-transition':'all 0.7s ease','-o-transition':'all 0.7s ease','transition':'all 0.7s ease'});});}};rfg.utils.removeTransition=function(el){if(rfg.utils.transitions){el.each(function(){$(this).css({'-webkit-transition':'none 0.7s ease','-moz-transition':'none 0.7s ease','-o-transition':'none 0.7s ease','transition':'none 0.7s ease'});});}};rfg.utils.transitions=(function(){function cssTransitions(){var div=document.createElement("div");var p,ext,pre=["ms","O","Webkit","Moz"];for(p in pre){if(div.style[pre[p]+"Transition"]!==undefined){ext=pre[p];break;}}
delete div;return ext;};return cssTransitions();}());if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length>>>0;var from=Number(arguments[1])||0;from=(from<0)?Math.ceil(from):Math.floor(from);if(from<0)
from+=len;for(;from<len;from++){if(from in this&&this[from]===elt)
return from;}
return-1;};}
Array.prototype.min=function(){var min=0,i=0;for(i;i<this.length;i=i+1){if(this[i]<this[min]){min=i;}}
return min;};Array.prototype.randomize=function(){var myArray=this;var i=myArray.length;if(i==0)return false;while(--i){var j=Math.floor(Math.random()*(i+1));var tempi=myArray[i];var tempj=myArray[j];myArray[i]=tempj;myArray[j]=tempi;}};}
(jQuery));